{% extends "dashboard.html" %}

{% block title %}Diet Plan - Gym Planner{% endblock %}
{% block main_content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 mt-4">
    <div class="text-center text-md-start mb-3 mb-md-0">
        <h1>Daily Diet Log</h1>
        <span class="fs-5 text-muted">{{ selected_date.strftime('%A, %B %d, %Y') }}</span>
    </div>
    <div class="d-flex align-items-center justify-content-center gap-2">
        <a href="{{ url_for('diet_plan', date=(selected_date - timedelta(days=1)).isoformat()) }}"
            class="btn btn-outline-secondary">&lt; Prev Day</a>
        <a href="{{ url_for('diet_plan') }}" class="btn btn-outline-secondary">Today</a>
        <a href="{{ url_for('diet_plan', date=(selected_date + timedelta(days=1)).isoformat()) }}"
            class="btn btn-outline-secondary">Next Day &gt;</a>
    </div>
</div>

<!-- Totals Summary -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Total Calories</h5>
                <p class="card-text fs-4 fw-bold">{{ totals.calories }} kcal</p>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Protein</h5>
                <p class="card-text fs-4 fw-bold">{{ totals.protein }} g</p>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Carbohydrates</h5>
                <p class="card-text fs-4 fw-bold">{{ totals.carbs }} g</p>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Fat</h5>
                <p class="card-text fs-4 fw-bold">{{ totals.fat }} g</p>
            </div>
        </div>
    </div>
</div>

<!-- Food Log Table -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>Food Log</h5>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addFoodModal">
            <i class="fas fa-plus"></i> Add Food
        </button>
    </div>
    <div class="card-body table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">Food</th>
                    <th scope="col">Calories (kcal)</th>
                    <th scope="col">Protein (g)</th>
                    <th scope="col">Carbs (g)</th>
                    <th scope="col">Fat (g)</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr>
                    <td>{{ entry.food_name }}</td>
                    <td>{{ entry.calories }}</td>
                    <td>{{ entry.protein_g }}</td>
                    <td>{{ entry.carbs_g }}</td>
                    <td>{{ entry.fat_g }}</td>
                    <td class="text-end">
                        <form method="POST" action="{{ url_for('delete_diet_entry_route', entry_id=entry._id) }}"
                            class="d-inline">
                            <input type="hidden" name="date" value="{{ selected_date.isoformat() }}">
                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete Entry"><i
                                    class="fas fa-trash-alt"></i>Delete</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted">No food logged for this day.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add Food Modal -->
<div class="modal fade" id="addFoodModal" tabindex="-1" aria-labelledby="addFoodModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{{ url_for('diet_plan') }}">
                <div class="modal-header">
                    <h5 class="modal-title" id="addFoodModalLabel">Add Food Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="date" value="{{ selected_date.isoformat() }}">
                    <div class="mb-3"><label for="food_name" class="form-label">Food Name</label><input type="text"
                            class="form-control" name="food_name" required></div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label for="calories" class="form-label">Calories
                                (kcal)</label><input type="number" class="form-control" name="calories" value="0"
                                required></div>
                        <div class="col-md-6 mb-3"><label for="protein_g" class="form-label">Protein (g)</label><input
                                type="number" class="form-control" name="protein_g" value="0" required></div>
                        <div class="col-md-6 mb-3"><label for="carbs_g" class="form-label">Carbs (g)</label><input
                                type="number" class="form-control" name="carbs_g" value="0" required></div>
                        <div class="col-md-6 mb-3"><label for="fat_g" class="form-label">Fat (g)</label><input
                                type="number" class="form-control" name="fat_g" value="0" required></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Entry</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock main_content %}